<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZStack AI Assistant</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-title">
      <span class="logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg></span>
      <span>ZStack AI</span>
      <span class="version-badge">v1.0</span>
    </div>
    <div class="header-actions">
      <button id="btn-export" class="icon-btn" title="导出对话为 Markdown">📥</button>
      <button id="btn-clear" class="icon-btn" title="清空对话">🗑️</button>
      <button id="btn-settings" class="icon-btn" title="设置"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </div>
  </div>

  <!-- Environment bar -->
  <div class="env-bar">
    <select id="env-select" class="env-select">
      <option value="">+ 添加环境</option>
    </select>
    <button id="btn-add-env" class="icon-btn" title="配置云平台"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg></button>
    <button id="btn-delete-env" class="icon-btn" title="删除环境"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1L9.64 7.64zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2z"/></svg></button>
    <button id="btn-llm-config" class="icon-btn" title="AI模型配置"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"/></svg></button>
  </div>

  <!-- Status bar -->
  <div id="status-bar" class="status-bar disconnected">
    <span class="status-dot"></span>
    <span id="status-text">未连接</span>
    <span id="status-model" class="status-model"></span>
    <div class="mode-toggle">
      <button id="btn-mode" class="mode-btn" title="点击切换查询模式"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg> 精简</button>
      <div id="mode-tooltip" class="mode-tooltip hidden">
        <p><b><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg> 精简模式</b>：统计概览 + 前20条预览，省 token，响应快</p>
        <p><b><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/></svg> 全量模式</b>：分批查询全部记录并完整展示，适合导出或全面分析</p>
      </div>
    </div>
  </div>

  <!-- Settings panel -->
  <div id="settings-panel" class="settings-panel hidden">
    <div class="settings-tabs">
      <button class="settings-tab active" data-tab="zstack"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg> 云平台</button>
      <button class="settings-tab" data-tab="llm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"/></svg> AI 模型</button>
      <button class="settings-tab" data-tab="theme"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg> 主题</button>
    </div>
    
    <div class="settings-content" id="tab-zstack">
      <div class="field">
        <label>平台类型</label>
        <select id="platform-type">
          <option value="zstack">ZStack</option>
          <option value="vSphere" disabled>vSphere (即将支持)</option>
          <option value="zaku" disabled>Zaku (即将支持)</option>
        </select>
      </div>
      <div class="field">
        <label>环境名称</label>
        <input type="text" id="env-name" placeholder="如：生产环境、测试环境">
      </div>
      <div class="field">
        <label>API 地址</label>
        <input type="text" id="zstack-endpoint" placeholder="http://172.24.245.30:8080">
      </div>
      <div class="field">
        <label>账号</label>
        <input type="text" id="zstack-account" placeholder="admin" value="admin">
      </div>
      <div class="field">
        <label>密码</label>
        <input type="password" id="zstack-password" placeholder="password">
      </div>
      <button id="btn-connect" class="btn btn-primary btn-full">保存配置并连接</button>
    </div>
    
    <div class="settings-content hidden" id="tab-llm">
      <div class="field">
        <label>提供商</label>
        <select id="llm-provider">
          <option value="openai">OpenAI</option>
          <option value="anthropic">Anthropic (Claude)</option>
          <option value="glm">智谱 GLM</option>
          <option value="deepseek">DeepSeek</option>
          <option value="qwen">通义千问 (Qwen)</option>
          <option value="minimax">MiniMax</option>
        </select>
      </div>
      <div class="field">
        <label>API Base URL <span class="field-hint">（留空用官方地址）</span></label>
        <input type="text" id="llm-baseurl" placeholder="https://api.openai.com">
      </div>
      <div class="field">
        <label>API Key</label>
        <input type="password" id="llm-apikey" placeholder="sk-...">
      </div>
      <div class="field">
        <label>模型</label>
        <div class="model-combo">
          <select id="llm-model-select">
            <option value="">选择模型...</option>
          </select>
          <input type="text" id="llm-model" placeholder="或输入自定义模型名">
        </div>
      </div>
      <button id="btn-save-llm" class="btn btn-primary btn-full">保存配置</button>
    </div>
    
    <div class="settings-content hidden" id="tab-theme">
      <div class="field">
        <label>主题模式</label>
        <select id="theme-color">
          <option value="system">跟随系统</option>
          <option value="dark">深色 (Dark)</option>
          <option value="light">浅色 (Light)</option>
        </select>
      </div>
      <button id="btn-save-theme" class="btn btn-primary btn-full">保存</button>
    </div>
  </div>

  <!-- Chat area -->
  <div id="chat-area" class="chat-area">
    <div class="welcome-msg">
      <div class="welcome-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg></div>
      <h2>ZStack AI 运维助手</h2>
      <p class="welcome-sub">用自然语言管理你的云平台</p>
      <div class="welcome-features">
        <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/></svg> 查询资源状态</div>
        <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg> 创建和管理云主机</div>
        <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg> ZQL 智能查询</div>
        <div class="feature-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/></svg> 全量数据导出</div>
      </div>
      <div class="quick-actions">
        <button class="quick-btn" data-msg="查看所有云主机"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/></svg> 查看云主机</button>
        <button class="quick-btn" data-msg="查看物理主机状态"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg> 物理主机</button>
        <button class="quick-btn" data-msg="查看可用镜像"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg> 可用镜像</button>
        <button class="quick-btn" data-msg="查看网络列表"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg> 网络列表</button>
        <button class="quick-btn" data-msg="查看存储状态"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"/></svg> 存储状态</button>
        <button class="quick-btn" data-msg="查看负载均衡"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg> 负载均衡</button>
      </div>
    </div>
  </div>

  <!-- Scroll to bottom button -->
  <button id="btn-scroll-bottom" class="scroll-bottom-btn hidden" title="滚动到底部">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
    </svg>
  </button>

  <!-- Input area -->
  <div class="input-area">
    <div class="input-wrapper">
      <textarea id="input" placeholder="输入指令，如：帮我查一下运行中的云主机" rows="1"></textarea>
      <button id="btn-stop" class="stop-btn hidden" title="停止生成">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="6" width="12" height="12" rx="2"/>
        </svg>
      </button>
      <button id="btn-send" class="send-btn" disabled>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
        </svg>
      </button>
    </div>
    <div class="input-hint">Enter 发送 · Shift+Enter 换行</div>
  </div>

  <script src="lib/marked.min.js"></script>
  <script src="lib/purify.min.js"></script>
  <script type="module" src="sidepanel.js"></script>
</body>
</html>
